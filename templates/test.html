<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Uploader</title>
</head>
<body>

    <div class="container">
        <h2>Upload Candidate Resume (PDF)</h2>
        <form id="resume-form" action="/upload" method="POST" enctype="multipart/form-data">
            <label for="resume">Choose a PDF file:</label>
            <input type="file" id="resume" name="resume" accept=".pdf" required>

            <label for="applied-job">Select the Applied Job:</label>
            <select id="applied-job" name="applied_job" required>
                <!-- Options will be populated dynamically -->
            </select>

            <input type="submit" value="Upload and Score">
        </form>

        <h2>Extracted Resume Information</h2>
        <table id="resume-info">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Score</th>
                </tr>
            </thead>
            <tbody>
                <!-- Resume details will be dynamically inserted here -->
            </tbody>
        </table>
    </div>

    <script>
 document.addEventListener('DOMContentLoaded', async function() {
    let jobSelect = document.querySelector('#applied-job');

    // Fetch the job titles from the backend and populate the dropdown
    let response = await fetch('/get_jobs');
    let jobs = await response.json();

    jobs.forEach(job => {
        let option = document.createElement('option');
        option.value = job.title;
        option.textContent = job.title;
        jobSelect.appendChild(option);
    });

    document.querySelector('#resume-form').addEventListener('submit', async function(e) {
        e.preventDefault();

        let formData = new FormData();
        formData.append("resume", document.querySelector('#resume').files[0]);
        formData.append("applied_job", document.querySelector('#applied-job').value);

        let response = await fetch('/upload', {
            method: 'POST',
            body: formData
        });

        let result = await response.json();

        if (result.error) {
            alert(result.error);
        } else {
            let tbody = document.querySelector('#resume-info tbody');
            tbody.innerHTML = `
                <tr>
                    <td>${result.Name || 'N/A'}</td>
                    <td>${result.Score.replace(/\n/g, '<br>') || 'N/A'}</td>
                </tr>
            `;
        }
    });
});
    </script>
</body>
</html>
